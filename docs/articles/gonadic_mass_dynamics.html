<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mizerSeasonal">
<title>Gonadic mass dynamics • mizerSeasonal</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Gonadic mass dynamics">
<meta property="og:description" content="mizerSeasonal">
<!-- mathjax --><script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js">
</script><!--
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
--><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mizerSeasonal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/mizerSeasonal.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/gonadic_mass_dynamics.html">Gonadic mass dynamics</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gustavdelius/mizerSeasonal/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Gonadic mass dynamics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gustavdelius/mizerSeasonal/blob/HEAD/vignettes/gonadic_mass_dynamics.Rmd" class="external-link"><code>vignettes/gonadic_mass_dynamics.Rmd</code></a></small>
      <div class="d-none name"><code>gonadic_mass_dynamics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="deriving-the-pde-for-gonadic-mass">Deriving the PDE for gonadic mass<a class="anchor" aria-label="anchor" href="#deriving-the-pde-for-gonadic-mass"></a>
</h2>
<p>Standard mizer describes the number density <span class="math inline">\(N(w,t)\)</span> by the PDE <span class="math display">\[\begin{equation}
\frac{\partial N}{\partial t} = -\frac{\partial}{\partial
w}(g\,N)-\mu\,N,
\label{PDEN}
\end{equation}\]</span> where <span class="math inline">\(g(w,t)\)</span> is the growth rate of an
individual of size <span class="math inline">\(w\)</span> and <span class="math inline">\(\mu(w,t)\)</span> is its death rate. This equation
simply states that the rate of change of the number of individuals in an
infinitesimal size range around <span class="math inline">\(w\)</span>
is given by the difference between the rate at which individuals grow
into the size range and the rate at which they grow out (the transport
term), minus the rate at which they die (the loss term).</p>
<p>Instead of the number density <span class="math inline">\(N\)</span>
we could have used the biomass density <span class="math inline">\(B =
w\,N\)</span> to describe the population. Its evolution equation can
easily be derived from <span class="math inline">\(\eqref{PDEN}\)</span>: <span class="math display">\[\begin{equation}\begin{split}
\frac{\partial B}{\partial t} &amp;= w\frac{\partial N}{\partial t}
= -w\frac{\partial}{\partial w}\left(g\,\frac{B}{w}\right)-\mu\,B,\\
&amp;=-\frac{\partial}{\partial
w}\left(g\,B\right)+g\,\frac{B}{w}-\mu\,B.
\end{split}\end{equation}\]</span> This is again intuitive: in addition
to the transport term and the loss term we now also have a source term
<span class="math inline">\(g B/w = gN\)</span> representing coming from
the growth taking place within the infinitesimal size class.</p>
<p>If we now denote by <span class="math inline">\(Q(w,t)\)</span> the
total gonadic biomass density and by <span class="math inline">\(G(w,t)\)</span> the gonadic growth rate of an
individual of size <span class="math inline">\(w\)</span> (when it is
not reproducing), then they satisfy the analogous equation <span class="math display">\[\begin{equation}
\frac{\partial Q}{\partial t}
=-\frac{\partial}{\partial w}\left(g\,Q\right)+G\,N-\mu\,Q-r\,Q,
\end{equation}\]</span> where we have an additional loss term
representing the release of gonadic mass during reproduction. The
release rate <span class="math inline">\(r(w,t)\)</span> will encode the
seasonality of this reproduction.</p>
<p>In mizer, the total energy <span class="math inline">\(E_r\)</span>
available for growth an reproduction is split as <span class="math inline">\(g=E_r(1-\psi)\)</span> and <span class="math inline">\(G=E_r\psi\)</span>. Thus <span class="math inline">\(G=g\,\psi/(1-\psi)\)</span>.</p>
<p>Instead of considering the total gonadic biomass density <span class="math inline">\(Q(w,t)\)</span>, we could consider the gonadic
mass <span class="math inline">\(q(w,t)\)</span> of an individual fish
of size <span class="math inline">\(w\)</span>, given by <span class="math display">\[\begin{equation}
q= \frac{Q}{N}.
\end{equation}\]</span> Let’s derive its evolution PDE: <span class="math display">\[\begin{equation}\label{PDEwG}\begin{split}
\frac{\partial q}{\partial t} &amp;= \frac{1}{N}\frac{\partial
Q}{\partial t}-
\frac{Q}{N^2}\frac{\partial N}{\partial t}\\
&amp;=\frac{1}{N}\left(-\frac{\partial}{\partial
w}\left(g\,Q\right)+G\,N-\mu\,Q-r\,Q\right)
-\frac{Q}{N^2}\left(-\frac{\partial}{\partial w}(g\,N)-\mu\,N\right).
\end{split}\end{equation}\]</span> To simplify this we observe that the
two mortality terms cancel and that <span class="math display">\[\begin{equation}\begin{split}
\frac{Q}{N^2}\frac{\partial}{\partial w}(g\,N)
&amp;=\frac{q}{N}\frac{\partial}{\partial
w}\left(g\,\frac{Q}{q}\right)\\
&amp;=\frac{1}{N}\frac{\partial}{\partial w}\left(g\,Q\right)
-g\,\frac{\partial q}{\partial w}.
\end{split}\end{equation}\]</span> Substituting this into <span class="math inline">\(\eqref{PDEwG}\)</span> and cancelling terms gives
<span class="math display">\[\begin{equation}
\frac{\partial q}{\partial t}=G-g\,\frac{\partial q}{\partial w}-r\, q.
\label{wg}
\end{equation}\]</span> At this point we feel a bit stupid when we
realise that <span class="math display">\[\begin{equation}
\frac{dq(w,t)}{dt}=\frac{\partial q(w,t)}{\partial t}+
\frac{\partial q(w,t)}{\partial w}\frac{dw}{dt}
\end{equation}\]</span> and that <span class="math inline">\(dw/dt =
g\)</span>, so that <span class="math inline">\(\eqref{wg}\)</span>
reduces to <span class="math display">\[\begin{equation}\label{dqdt}
\frac{dq}{dt}=G-r\,q,
\end{equation}\]</span> which is what we could have written down
immediately, given our definition of <span class="math inline">\(G\)</span>. So this equation would have been a
good starting point for deriving the PDE <span class="math inline">\(\eqref{wg}\)</span>.</p>
<p>All the above equations are species specific. So in particular there
is one gonadic mass function <span class="math inline">\(q_i(w,t)\)</span> for each species <span class="math inline">\(i\)</span> and we will need to specify one rate
function <span class="math inline">\(r_i(w,t)\)</span> for each species
<span class="math inline">\(i\)</span>.</p>
<p>We need to specify the mass-specific release rate <span class="math inline">\(r(w,t)\)</span>. This then determines the total
reproduction rate <span class="math display">\[\begin{equation}
R_p(t)=\frac{\epsilon}{2w_0}\int N(w,t)q(w,t)r(w,t)dw.
\end{equation}\]</span> It will be difficult to know how to choose the
mass-specific rate <span class="math inline">\(r(w,t)\)</span> to
produce the observed egg production rate <span class="math inline">\(R_p(t)\)</span>. We’ll probably have to do this by
trial and error initially. The rate <span class="math inline">\(r(w,t)\)</span> should become large at least once
a year so that the gonadic mass goes back to close to zero. One
possibility would be to make <span class="math inline">\(r(w,t)\)</span>
independent of <span class="math inline">\(w\)</span>.</p>
</div>
<div class="section level2">
<h2 id="numerical-implementation">Numerical implementation<a class="anchor" aria-label="anchor" href="#numerical-implementation"></a>
</h2>
<p>To solve the PDE <span class="math inline">\(\eqref{wg}\)</span> we
use the same upwind-difference scheme used by mizer to solve the PDE
<span class="math inline">\(\eqref{PDEN}\)</span>. Let us therefore
recall the details of that scheme.</p>
<p>We discretise <span class="math inline">\(\eqref{PDEN}\)</span> as
follows: <span class="math display">\[\begin{equation}\label{nd}
    \frac{N_w^{t+1}-N_w^t}{\Delta
t}=-\frac{g_w^tN_w^{t+1}-g_{w-1}^tN_{w-1}^{t+1}}{\Delta
w}-\mu_w^t\,N_w^{t+1}.
\end{equation}\]</span> Here we use <span class="math inline">\(w\)</span> and <span class="math inline">\(t\)</span> to denote the integer indices of the
discretised weight and discretised time respectively. Multiplying by
<span class="math inline">\(\Delta t\)</span> and collecting terms gives
<span class="math display">\[\begin{equation}\label{ndc}
    N_w^{t+1}\left(1+g_w^t\frac{\Delta t}{\Delta w}+\mu_t^w\,\Delta
t\right)=
    N_{w-1}^{t+1}\left(g_{w-1}^t\frac{\Delta t}{\Delta w}\right)
    +N_w^t.
\end{equation}\]</span> Solving for <span class="math inline">\(N_w^{t+1}\)</span> gives <span class="math display">\[\begin{equation}\label{nds}
    N_w^{t+1}=\frac{S_w^t-A_w^tN_{w-1}^{t+1}}{B_w^t},
\end{equation}\]</span> where <span class="math display">\[\begin{equation}\label{ABS}
\begin{split}
   A_w^t&amp;=-g_{w-1}^t\frac{\Delta t}{\Delta w},\\
   B_w^t&amp;=1+g_w^t\frac{\Delta t}{\Delta w}+\mu_t^w\,\Delta t,\\
   S_w^t&amp;=N_w^t.
\end{split}
\end{equation}\]</span> Given an initial value and a boundary condition
encoding the influx of new-born individuals to the smallest size class,
The recurrence relation <span class="math inline">\(\eqref{nds}\)</span>
allows mizer to calculate <span class="math inline">\(N_w^{t+1}\)</span>
for all size classes at all later times.</p>
<p>Now we use the same scheme for the gonadic dynamics. So we discretise
<span class="math inline">\(\eqref{wg}\)</span> as follows: <span class="math display">\[\begin{equation}
    \frac{q_w^{t+1}-q_w^t}{\Delta
t}=-g_w^t\frac{q_w^{t+1}-q_{w-1}^{t+1}}{\Delta
w}-r_w^t\,q_w^{t+1}+G_w^t.
\end{equation}\]</span> Note how close this equation for <span class="math inline">\(q\)</span> is to equation <span class="math inline">\(\eqref{nd}\)</span> for <span class="math inline">\(N\)</span>. Multiplying by <span class="math inline">\(\Delta t\)</span> and collecting terms gives <span class="math display">\[\begin{equation}
    q_w^{t+1}\left(1+g_w^t\frac{\Delta t}{\Delta w}+r_t^w\,\Delta
t\right)=
    q_{w-1}^{t+1}\left(g_w^t\frac{\Delta t}{\Delta w}\right)
    +q_w^t+G_w^t\,\Delta t.
\end{equation}\]</span> Solving for <span class="math inline">\(q_w^{t+1}\)</span> gives <span class="math display">\[\begin{equation}\label{qds}
    q_w^{t+1}=\frac{s_w^t-a_w^tq_{w-1}^{t+1}}{b_w^t},
\end{equation}\]</span> where <span class="math display">\[\begin{equation}\label{abs}
\begin{split}
   a_w^t&amp;=-g_w^t\frac{\Delta t}{\Delta w},\\
   b_w^t&amp;=1+g_w^t\frac{\Delta t}{\Delta w}+r_t^w\,\Delta t,\\
   s_w^t&amp;=q_w^t+G_w^t\,\Delta t.
\end{split}
\end{equation}\]</span> Together with an initial value and the boundary
condition that <span class="math inline">\(q_1^t=0\)</span> at all times
because the smallest individuals do not yet have any gonadic mass, this
recurrence relation allows us to calculate <span class="math inline">\(q_w^{t+1}\)</span> for all size classes at all
later times.</p>
<p>Note how small the difference is between the discretised equation
<span class="math inline">\(\eqref{qds}\)</span> for <span class="math inline">\(q\)</span> and the equation <span class="math inline">\(\eqref{nds}\)</span> for <span class="math inline">\(N\)</span>. The only difference lies in replacing
<span class="math inline">\(A_w^t, B_w^t\)</span> and <span class="math inline">\(S_w^t\)</span> given in <span class="math inline">\(\eqref{ABS}\)</span> by <span class="math inline">\(a_w^t, b_w^t\)</span> and <span class="math inline">\(s_w^t\)</span> given in <span class="math inline">\(\eqref{abs}\)</span>.</p>
</div>
<div class="section level2">
<h2 id="open-problems">Open problems<a class="anchor" aria-label="anchor" href="#open-problems"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Once we are modelling cohorts in mizer, the diffusion terms in
the size-spectrum dynamics will become important, because they will lead
to the broadening of the cohorts.</p></li>
<li><p>We do not yet know what the required step sizes are in size and
in time to faithfully reproduce the dynamics. Too large size steps will
lead to too much numerical diffusion. Too large time steps may lead to
numerical instability.</p></li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Gustav Delius, Michael A. Spence.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
