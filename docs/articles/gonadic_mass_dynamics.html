<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Gonadic mass dynamics • mizerSeasonal</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><script src="gonadic_mass_dynamics_files/libs/quarto-html/popper.min.js"></script><script src="gonadic_mass_dynamics_files/libs/quarto-html/tippy.umd.min.js"></script><link href="gonadic_mass_dynamics_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="gonadic_mass_dynamics_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Gonadic mass dynamics">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mizerSeasonal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/mizerSeasonal.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/gonadic_mass_dynamics.html">Gonadic mass dynamics</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gustavdelius/mizerSeasonal/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Gonadic mass dynamics</h1>




      <small class="dont-index">Source: <a href="https://github.com/gustavdelius/mizerSeasonal/blob/HEAD/vignettes/gonadic_mass_dynamics.qmd" class="external-link"><code>vignettes/gonadic_mass_dynamics.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2"><h2 id="deriving-the-pde-for-gonadic-mass">Deriving the PDE for gonadic mass<a class="anchor" aria-label="anchor" href="#deriving-the-pde-for-gonadic-mass"></a>
</h2>
<p>Standard mizer describes the number density <span class="math inline">\(N(w,t)\)</span> by the PDE <span id="eq-PDEN"><span class="math display">\[
\frac{\partial N}{\partial t} = -\frac{\partial}{\partial w}(g\,N)-\mu\,N,
\tag{1}\]</span></span> where <span class="math inline">\(g(w,t)\)</span> is the growth rate of an individual of size <span class="math inline">\(w\)</span> and <span class="math inline">\(\mu(w,t)\)</span> is its death rate. This equation simply states that the rate of change of the number of individuals in an infinitesimal size range around <span class="math inline">\(w\)</span> is given by the difference between the rate at which individuals grow into the size range and the rate at which they grow out (the transport term), minus the rate at which they die (the loss term).</p>
<p>Instead of the number density <span class="math inline">\(N\)</span> we could have used the biomass density <span class="math inline">\(B = w\,N\)</span> to describe the population. Its evolution equation can easily be derived from <a href="#eq-PDEN" class="quarto-xref">Equation 1</a> <span class="math display">\[\begin{split}
\frac{\partial B}{\partial t} &amp;= w\frac{\partial N}{\partial t}
= -w\frac{\partial}{\partial w}\left(g\,\frac{B}{w}\right)-\mu\,B,\\
&amp;=-\frac{\partial}{\partial w}\left(g\,B\right)+g\,\frac{B}{w}-\mu\,B.
\end{split}\]</span> This is again intuitive: in addition to the transport term and the loss term we now also have a source term <span class="math inline">\(g B/w = gN\)</span> representing coming from the growth taking place within the infinitesimal size class.</p>
<p>If we now denote by <span class="math inline">\(Q(w,t)\)</span> the total gonadic biomass density and by <span class="math inline">\(G(w,t)\)</span> the gonadic growth rate of an individual of size <span class="math inline">\(w\)</span> (when it is not reproducing), then they satisfy the analogous equation <span class="math display">\[
\frac{\partial Q}{\partial t}
=-\frac{\partial}{\partial w}\left(g\,Q\right)+G\,N-\mu\,Q-r\,Q,
\]</span> where we have an additional loss term representing the release of gonadic mass during reproduction. The release rate <span class="math inline">\(r(w,t)\)</span> will encode the seasonality of this reproduction.</p>
<p>In mizer, the total energy <span class="math inline">\(E_r\)</span> available for growth an reproduction is split as <span class="math inline">\(g=E_r(1-\psi)\)</span> and <span class="math inline">\(G=E_r\psi\)</span>. Thus <span class="math inline">\(G=g\,\psi/(1-\psi)\)</span>.</p>
<p>Instead of considering the total gonadic biomass density <span class="math inline">\(Q(w,t)\)</span>, we could consider the gonadic mass <span class="math inline">\(q(w,t)\)</span> of an individual fish of size <span class="math inline">\(w\)</span>, given by <span class="math display">\[
q= \frac{Q}{N}.
\]</span> Let’s derive its evolution PDE: <span id="eq-PDEwG"><span class="math display">\[\begin{split}
\frac{\partial q}{\partial t} &amp;= \frac{1}{N}\frac{\partial Q}{\partial t}-
\frac{Q}{N^2}\frac{\partial N}{\partial t}\\
&amp;=\frac{1}{N}\left(-\frac{\partial}{\partial w}\left(g\,Q\right)+G\,N-\mu\,Q-r\,Q\right)
-\frac{Q}{N^2}\left(-\frac{\partial}{\partial w}(g\,N)-\mu\,N\right).
\end{split} \tag{2}\]</span></span> To simplify this we observe that the two mortality terms cancel and that <span class="math display">\[\begin{split}
\frac{Q}{N^2}\frac{\partial}{\partial w}(g\,N)
&amp;=\frac{q}{N}\frac{\partial}{\partial w}\left(g\,\frac{Q}{q}\right)\\
&amp;=\frac{1}{N}\frac{\partial}{\partial w}\left(g\,Q\right)
-g\,\frac{\partial q}{\partial w}.
\end{split}\]</span> Substituting this into <a href="#eq-PDEwG" class="quarto-xref">Equation 2</a> and cancelling terms gives <span id="eq-wg"><span class="math display">\[
\frac{\partial q}{\partial t}=G-g\,\frac{\partial q}{\partial w}-r\, q.
\tag{3}\]</span></span> At this point we feel a bit stupid when we realise that <span class="math display">\[
\frac{dq(w,t)}{dt}=\frac{\partial q(w,t)}{\partial t}+
\frac{\partial q(w,t)}{\partial w}\frac{dw}{dt}
\]</span> and that <span class="math inline">\(dw/dt = g\)</span>, so that <a href="#eq-wg" class="quarto-xref">Equation 3</a> reduces to <span id="eq-dqdt"><span class="math display">\[
\frac{dq}{dt}=G-r\,q,
\tag{4}\]</span></span> which is what we could have written down immediately, given our definition of <span class="math inline">\(G\)</span>. So this equation would have been a good starting point for deriving the PDE <a href="#eq-wg" class="quarto-xref">Equation 3</a>.</p>
<p>All the above equations are species specific. So in particular there is one gonadic mass function <span class="math inline">\(q_i(w,t)\)</span> for each species <span class="math inline">\(i\)</span> and we will need to specify one rate function <span class="math inline">\(r_i(w,t)\)</span> for each species <span class="math inline">\(i\)</span>.</p>
<p>We need to specify the mass-specific release rate <span class="math inline">\(r(w,t)\)</span>. This then determines the total reproduction rate <span class="math display">\[\begin{equation}
R_p(t)=\frac{\epsilon}{2w_0}\int N(w,t)q(w,t)r(w,t)dw.
\end{equation}\]</span> It will be difficult to know how to choose the mass-specific rate <span class="math inline">\(r(w,t)\)</span> to produce the observed egg production rate <span class="math inline">\(R_p(t)\)</span>. We’ll probably have to do this by trial and error initially. The rate <span class="math inline">\(r(w,t)\)</span> should become large at least once a year so that the gonadic mass goes back to close to zero. One possibility would be to make <span class="math inline">\(r(w,t)\)</span> independent of <span class="math inline">\(w\)</span>.</p>
</section><section class="level2"><h2 id="numerical-implementation">Numerical implementation<a class="anchor" aria-label="anchor" href="#numerical-implementation"></a>
</h2>
<p>To solve the PDE <a href="#eq-wg" class="quarto-xref">Equation 3</a> we use the same upwind-difference scheme used by mizer to solve the PDE <a href="#eq-PDEN" class="quarto-xref">Equation 1</a>. Let us therefore recall the details of that scheme.</p>
<p>We discretise <a href="#eq-PDEN" class="quarto-xref">Equation 1</a> as follows: <span id="eq-nd"><span class="math display">\[
    \frac{N_w^{t+1}-N_w^t}{\Delta t}=-\frac{g_w^tN_w^{t+1}-g_{w-1}^tN_{w-1}^{t+1}}{\Delta w}-\mu_w^t\,N_w^{t+1}.
\tag{5}\]</span></span> Here we use <span class="math inline">\(w\)</span> and <span class="math inline">\(t\)</span> to denote the integer indices of the discretised weight and discretised time respectively. Multiplying by <span class="math inline">\(\Delta t\)</span> and collecting terms gives <span id="eq-ndc"><span class="math display">\[
    N_w^{t+1}\left(1+g_w^t\frac{\Delta t}{\Delta w}+\mu_w^t\,\Delta t\right)=
    N_{w-1}^{t+1}\left(g_{w-1}^t\frac{\Delta t}{\Delta w}\right)
    +N_w^t.
\tag{6}\]</span></span> Solving for <span class="math inline">\(N_w^{t+1}\)</span> gives <span id="eq-nds"><span class="math display">\[
    N_w^{t+1}=\frac{S_w^t-A_w^tN_{w-1}^{t+1}}{B_w^t},
\tag{7}\]</span></span> where <span id="eq-ABS"><span class="math display">\[
\begin{split}
   A_w^t&amp;=-g_{w-1}^t\frac{\Delta t}{\Delta w},\\
   B_w^t&amp;=1+g_w^t\frac{\Delta t}{\Delta w}+\mu^t_w\,\Delta t,\\
   S_w^t&amp;=N_w^t.
\end{split}
\tag{8}\]</span></span> Given an initial value and a boundary condition encoding the influx of new-born individuals to the smallest size class, The recurrence relation <a href="#eq-nds" class="quarto-xref">Equation 7</a> allows mizer to calculate <span class="math inline">\(N_w^{t+1}\)</span> for all size classes at all later times.</p>
<p>Now we use the same scheme for the gonadic dynamics. So we discretise <a href="#eq-wg" class="quarto-xref">Equation 3</a> as follows: <span class="math display">\[
    \frac{q_w^{t+1}-q_w^t}{\Delta t}=-g_w^t\frac{q_w^{t+1}-q_{w-1}^{t+1}}{\Delta w}-r_w^t\,q_w^{t+1}+G_w^t.
\]</span> Note how close this equation for <span class="math inline">\(q\)</span> is to equation <a href="#eq-nd" class="quarto-xref">Equation 5</a> for <span class="math inline">\(N\)</span>. Multiplying by <span class="math inline">\(\Delta t\)</span> and collecting terms gives <span class="math display">\[
    q_w^{t+1}\left(1+g_w^t\frac{\Delta t}{\Delta w}+r_w^t\,\Delta t\right)=
    q_{w-1}^{t+1}\left(g_w^t\frac{\Delta t}{\Delta w}\right)
    +q_w^t+G_w^t\,\Delta t.
\]</span> Solving for <span class="math inline">\(q_w^{t+1}\)</span> gives <span id="eq-qds"><span class="math display">\[
    q_w^{t+1}=\frac{s_w^t-a_w^tq_{w-1}^{t+1}}{b_w^t},
\tag{9}\]</span></span> where <span id="eq-abs"><span class="math display">\[
\begin{split}
   a_w^t&amp;=-g_w^t\frac{\Delta t}{\Delta w},\\
   b_w^t&amp;=1+g_w^t\frac{\Delta t}{\Delta w}+r_w^t\,\Delta t,\\
   s_w^t&amp;=q_w^t+G_w^t\,\Delta t.
\end{split}
\tag{10}\]</span></span> Together with an initial value and the boundary condition that <span class="math inline">\(q_1^t=0\)</span> at all times because the smallest individuals do not yet have any gonadic mass, this recurrence relation allows us to calculate <span class="math inline">\(q_w^{t+1}\)</span> for all size classes at all later times.</p>
<p>Note how small the difference is between the discretised equation <a href="#eq-qds" class="quarto-xref">Equation 9</a> for <span class="math inline">\(q\)</span> and the equation <a href="#eq-nds" class="quarto-xref">Equation 7</a> for <span class="math inline">\(N\)</span>. The only difference lies in replacing <span class="math inline">\(A_w^t, B_w^t\)</span> and <span class="math inline">\(S_w^t\)</span> given in <a href="#eq-ABS" class="quarto-xref">Equation 8</a> by <span class="math inline">\(a_w^t, b_w^t\)</span> and <span class="math inline">\(s_w^t\)</span> given in <a href="#eq-abs" class="quarto-xref">Equation 10</a>.</p>
</section><section class="level2"><h2 id="open-problems">Open problems<a class="anchor" aria-label="anchor" href="#open-problems"></a>
</h2>
<ol type="1">
<li><p>Once we are modelling cohorts in mizer, the diffusion terms in the size-spectrum dynamics will become important, because they will lead to the broadening of the cohorts.</p></li>
<li><p>We do not yet know what the required step sizes are in size and in time to faithfully reproduce the dynamics. Too large size steps will lead to too much numerical diffusion. Too large time steps may lead to numerical instability.</p></li>
</ol></section><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'light-border',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gustav Delius, Michael A. Spence.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
